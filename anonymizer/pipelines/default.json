{
  "policies": {
    "discard_response_on_failure": true,
    "optional": [
      "update",
      "publish"
    ]
  },
  "stages": [
    {
      "name": "prepare"
    },
    {
      "name": "anonymize"
    },
    {
      "name": "update"
    },
    {
      "name": "publish"
    },
    {
      "name": "reply"
    }
  ],
  "jobs": {
    "read-privacy-policy": {
      "type": "policies.ReadPrivacyPolicy",
      "stage": "prepare",
      "args": {
        "address": "Privacy-policy",
        "location": "privacy_policy"
      }
    },
    "read-hierarchy-policy": {
      "type": "policies.ReadHierarchyPolicy",
      "stage": "prepare",
      "args": {
        "address": "Hierarchy-policy",
        "location": "hierarchy_policy"
      }
    },
    "move-event": {
      "type": "misp.ExtractEventFromEventAnon",
      "stage": "publish",
      "args": {
        "source": "body",
        "destination": "event"
      }
    },
    "reply-with-event": {
      "type": "ModelPong",
      "stage": "reply",
      "args": {
        "object_location": "event"
      }
    },
    "apply-policy-local": {
      "type": "local.FromPrivacyPolicy",
      "stage": "anonymize",
      "args": {
        "privacy_policy_location": "privacy_policy",
        "hierarchy_policy_location": "hierarchy_policy"
      }
    },
    "apply-policy-dp": {
      "type": "flaskdp.FromPrivacyPolicy",
      "stage": "anonymize",
      "args": {
        "privacy_policy_location": "privacy_policy"
      }
    },
    "apply-policy-arxlet": {
      "type": "arxlet.FromPrivacyPolicy",
      "stage": "anonymize",
      "args": {
        "privacy_policy_location": "privacy_policy",
        "hierarchy_policy_location": "hierarchy_policy"
      }
    },
    "store-event-in-context": {
      "type": "context.StoreRequest",
      "stage": "prepare"
    },
    "update_misp_event": {
      "type": "misp.UpdateEvent",
      "stage": "update",
      "args": {
        "event_location": "body"
      }
    },
    "publish_misp_event": {
      "type": "misp.PostEvent",
      "stage": "publish",
      "args": {
        "event_location": "body",
        "event_anon": true,
        "publish": true
      }
    }
  }
}
